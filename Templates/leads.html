{% extends 'base.html' %} 
{% block title %}newleads{% endblock %} 
{% block content %} 
{%load static %}
<head>
  <link rel="stylesheet" href="{% static 'css/leads_view.css' %}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
  <style>
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8); /* Transparent background */
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      width: 400px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .modal-content h2 {
      margin: 0 0 15px;
    }
    .modal-content .buttons button {
      margin: 0 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: #fff;
    }
    .modal-content .buttons .confirm {
      background: #2a7fb3; /* Green color */
    }
    .modal-content .buttons .cancel {
      background: #6c757d; /* Gray color */
    }
    .modal-content .buttons button:hover {
      opacity: 0.9;
    }
    h2{
      font-size: 15px;
    }
  </style>
</head>
<div class="leads_view">
  <form action="/newleads/" method="">
    <div class="button-group">
      <button type="submit" class="leadbutton">New Leads</button>
    </div>
  </form>
  <form action="{% url 'leads' %}" method="">
    {% csrf_token %}
    <h4 class="head4">Filter By:</h4>
    <div class="form-row">
      <div class="form-group">
        <select id="assigned" name="assigned" class="selectbox">
          <option value="" disabled {% if not request.GET.assigned %}selected{% endif %}>Assign</option>
          <option value="Assigned" {% if request.GET.assigned == "Assigned" %}selected{% endif %}>Assigned</option>
          <option value="Not Assigned" {% if request.GET.assigned == "Not Assigned" %}selected{% endif %}>Not Assigned</option>
        </select>
      </div>
      <div class="form-group">
        <select id="status" name="status" class="selectbox">
          <option value="" disabled {% if not request.GET.status %}selected{% endif %}>Status</option>
          <option value="Open"      {% if request.GET.status == "Open" %}selected{% endif %}>Open</option>
          <option value="Canceled"  {% if request.GET.status == "Canceled" %}selected{% endif %}>Canceled</option>
          <option value="In process"{% if request.GET.status == "In process" %}selected{% endif %}>In process</option>
        </select>
      </div>

      <div class="form-group">
        <select id="specialization" name="specialization" class="selectbox">
          <option value="" disabled  {% if not request.GET.specialization %}selected{% endif %}>Specialization</option>
          <option value="general"    {% if request.GET.specialization == "general" %}selected{% endif %}>General</option>
          <option value="cardiology" {% if request.GET.specialization == "cardiology" %}selected{% endif %}>Cardiology</option>
          <option value="neurology"  {% if request.GET.specialization == "neurology" %}selected{% endif %}>Neurology</option>
          <option value="orthopedics"{% if request.GET.specialization == "orthopedics" %}selected{% endif %}>Orthopedics</option>
          <option value="oncology"   {% if request.GET.specialization == "oncology" %}selected{% endif %}>Oncology</option>
          <option value="psychiatry" {% if request.GET.specialization == "psychiatry" %}selected{% endif %}>Psychiatry</option>
          <option value="dermatology"{% if request.GET.specialization == "dermatology" %}selected{% endif %}>Dermatology</option>
        </select>
      </div>

      <div class="form-group" >
          <input class="selectbox" type="text" class="L3" id="phone" name="phone" placeholder="Mobile Number" value="{{ request.GET.phone|default:'' }}">
      </div>
      <div>
        <button type="submit" class="framebutton">
          <img src="{% static 'images/icon_search.png' %}" style="height: 20px;">
        </button>
        <a href="{% url 'leads' %}" class="refreshbutton">
          <img src="{% static 'images/refresh.png' %}" style="height: 20px;">
        </a>
      </div>
    </div>
  </form>
  <div>
    <form action="/leadssummary/">
        {% csrf_token %}
      <p>
        Lead Summary
      </p>
      <table class="doctors-table">
        <thead>
          <tr>
            <th>SL NO</th>
            <th>Name</th>
            <th>Company</th>
            <th>Phone Number</th>
            <th>Email</th>
            <th>Assigned</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for lead in leads %}
          <tr>
            <td>#{{ forloop.counter }}</td>
            <td>{{ lead.name }}</td>
            <td>{{ lead.clinic_name }}</td>
            <td>{{ lead.phone }}</td>
            <td>{{ lead.email }}</td>
            <td>{{ lead.assigned }}</td>
            <td>{{ lead.status }}</td>

            <td>
              <a href="{% url 'edit_lead' lead.id %}">
                <img src="{% static 'images/edit (1) 2.png' %}"  style="width: 20px; height: 20px;text-decoration: none;">
              </a>&nbsp;
              <a href="/deletelead/{{lead.id}}" class="confirm-delete" id="deleteButton" data-id="{{ lead.id }}">
                <img src="{% static 'images/trash-2 2.png' %}"  style="width: 20px; height: 20px;text-decoration: none;">
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8">No leads found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="pagination">
        <span class="step-links">
            {% if leads.has_previous %}
                <a href="?page=1">&laquo; First</a>
                <a href="?page={{ leads.previous_page_number }}">Previous</a>
            {% endif %}
    
            {% for page_num in leads.paginator.page_range %}
                {% if page_num == leads.number %}
                    <span class="current"> 
                        {{ page_num }}
                    </span>
                {% elif page_num >= leads.number|add:'-2' and page_num <= leads.number|add:'2' %}
                    <a href="?page={{ page_num }}">{{ page_num }}</a>
                {% elif page_num == 1 or page_num == leads.paginator.num_pages %}
                    <a href="?page={{ page_num }}">{{ page_num }}</a>
                {% endif %}
            {% endfor %}
    
            {% if leads.has_next %}
                <a href="?page={{ leads.next_page_number }}">Next</a>
                <a href="?page={{ leads.paginator.num_pages }}">Last &raquo;</a>
            {% endif %}
        </span>
    </div>
    </form>
  </div>
</div>
<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h2>Are you sure you want to delete this lead?</h2>
    <div class="buttons">
      <button class="confirm" id="confirmDelete"> Delete</button>
      <button class="cancel" id="cancelDelete">Cancel</button>
    </div>
  </div>
</div>

<script>
  // Variables
  const modal = document.getElementById('deleteModal');
  const confirmDelete = document.getElementById('confirmDelete');
  const cancelDelete = document.getElementById('cancelDelete');
  let leadToDelete = null;

  // Show modal on delete button click
  document.querySelectorAll('.confirm-delete').forEach(button => {
    button.addEventListener('click', (e) => {
      e.preventDefault();
      leadToDelete = button.getAttribute('data-id');
      modal.style.display = 'flex';
    });
  });

  // Confirm delete
  confirmDelete.addEventListener('click', () => {
    modal.style.display = 'none';
    if (leadToDelete) {
      window.location.href = `/deletelead/${leadToDelete}`;
    }
  });

  // Cancel delete
  cancelDelete.addEventListener('click', () => {
    modal.style.display = 'none';
    leadToDelete = null;
  });

  // Close modal if clicked outside
  window.addEventListener('click', (event) => {
    if (event.target === modal) {
      modal.style.display = 'none';
      leadToDelete = null;
    }
  });
</script>

{% endblock %}